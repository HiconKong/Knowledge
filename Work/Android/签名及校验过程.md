# 证书
  ## 类型
  * CA签发
    * 应用场景:服务器与浏览器(官方权威机构判定是否合法)
    * 包含:
      - 证书的发布机构
      - 证书的有效期
      - 公钥
      - 证书所有者（Subject）
      - 签名所使用的算法
      - 指纹以及指纹算法
  * 非CA签发
    * 应用场景:Android中安装和校验app(当第一次证书与实体(applicationId)捆绑后，即认定其为合法，只要证书变化即非法))
    * 包含:
    * 作用:
      - 应用升级：当安装应用的更新时，系统会比较新版本和现有版本中的证书。如果证书匹配，则系统允许更新。如果使用不同的证书为新版本签名，您必须为应用分配另一个软件包名称 - 在此情况下，用户会将新版本作为全新应用进行安装。
      - 应用模块化：Android 允许通过同一证书签名的多个 APK 在同一个进程中运行（如果应用请求这样做），以便系统将其视为单个应用。这样一来，您便可以按模块部署您的应用，并且用户可以独立更新每个模块。
      - 通过权限共享代码/数据：Android 提供了基于签名的权限执行机制，以便一个应用可以将功能提供给使用指定证书签名的另一个应用。通过使用同一个证书为多个 APK 签名并使用基于签名的权限检查功能，您的应用可以采用安全的方式共享代码和数据。
  ## 如何生成
    * keytool
    * Android Stduio工具(Build->generate Signed APK)
  ## 组成
  ## 作用
  ## 意义

# 签名/签名过程 --- 代码模拟
  ## V1机制 (https://sq.163yun.com/blog/article/173550790375084032)
  * MANIFEST.MF
    - 对apk中所有的文件进行摘要(SHA1)计算，然后转成base64
  * CERT.SF
    - 主属性中记录了整个MF文件的摘要(对MF文件进行摘要计算(SHA1)，然后转成base64编码)
    - 对MF文件中对应条目再次进行摘要计算(对对应条目进行摘要计算(SHA1)，然后转成base64编码)
      + 注意:.MF文件是以空行分隔的，计算.MF各条目摘要时需要再加一个换行符，
  * CERT.RSA
    - 根据私钥算法得到对应的签名算法，再用签名算法对签名数据（这里是 .SF 文件）进行签名，最后把签名数据和证书放在一起生成字节数组
    — 包含:
      + 用私钥对 .SF 文件指纹进行非对称加密后得到的加密数据
      + 携带公钥以及各种身份信息的数字证书
      + 通过 openssl pkcs7 -inform DER -in META-INF/CERT.RSA -noout -print_certs -text 可以看到证书签名算法、有效期、证书主体、证书签发者、公钥等信息

  ## V2机制信息
  * 针对APK进行校验，将APK分成1M的块，对每个块计算值摘要，之后针对所有摘要进行摘要，再利用摘要进行签名

  ## 实践
  * 提取易微联app证书公钥
  * 通过代码对目录中的某一个文件完成整个签名过程

  
# 校验/校验过程 --- 代码模拟
  ## V1机制
  * 校验CERT.SF文件的签名
    - 计算CERT.SF文件的摘要，将其与签名者公钥解密签名得到的摘要进行对比，如果一致则进入下一步;
  * 校验MAINFEST.MF文件的完整性
    — 计算MAINFEST.MF文件的摘要，与CERT.SF主属性中记录的摘要进行对比，如一致则逐一校验mf文件各个条目的完整性;
  * 校验APK中每个文件的完整性
    - 逐一计算apk中每个文件（META-INF目录除外）的摘要，与MF中的记录进行对比，如全部一致，刚校验通过;
  * 校验签名的一致性
    - 如果是升级安装，还需校验证书签名是否与已安装app一致。




加密：公钥加密，私钥解密的过程，称为「加密」
签名：私钥加密，公钥解密的过程，称为「签名」。



# 签名工具(介绍文件类型及实操)
  * 作用:利用密钥仓库中的信息来产生或校验 Java 存档 (JAR) 文件的数字签名
  * 类型
    - jarsigner(使用keystore文件)
    - apksigner(使用pk8,x509.pem文件)
  * 区别:证书和秘钥存储的格式不同，前者是通过 Java KeyStore（.jks 文件或者 .keystore 文件） 格式，后者分别用 .pem 和 .pk8 格式来存储证书和密钥






# 签名文件格式
  * keystore: KeyStore 是 Eclipse 开发 Android 的时候最早的签名文件了。
  * jks (Java key store): jks 是目前 Android Studio 中创建签名文件的格式 (Build -> Generate Signed APK) 即可创建和使用签名文件为对应apk进行签名
  * pem/pk8 :这个是系统的签名文件，Android系统在编译的时候也是需要签名，所以这个是系统的签名文件，如果想使自己的应用变成系统应用，则必须使用系统的签名文件进行签名。

# keytool
  * 密钥和证书管理工具，可以用来生成证书

# 将apk证书签名校验过程及https证书校验过程做对比
  ## apk 签名及校验过程
    * 

# 数字签名
 * https://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html
# AUTH2 流程

# 指纹/指纹算法

# 加密(对称/非对称)
